<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Rocket vs. Asteroids</title>
<style>
  :root { --ui:#fff; --bg:#0a0f1a; --accent:#35e0ff; --warn:#ff506d; }
  html,body { margin:0; height:100%; background:var(--bg); color:var(--ui); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; }
  #game { display:block; width:100vw; height:100vh; touch-action:none; background:
    radial-gradient(1200px 700px at 70% -10%, #152240 0%, transparent 60%),
    radial-gradient(1000px 600px at 10% 110%, #101a30 0%, transparent 60%),
    #060a12; }
  .hud { position:fixed; left:0; right:0; top:0; display:flex; gap:.75rem; align-items:center; justify-content:space-between; padding:.5rem .75rem; font-weight:600; pointer-events:none; }
  .pill { background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.15); border-radius:999px; padding:.35rem .7rem; }
  #centerMsg { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; text-align:center; padding:1rem; pointer-events:none; }
  #centerMsg .card { background:rgba(8,12,22,.9); border:1px solid rgba(255,255,255,.15); border-radius:14px; max-width:520px; padding:18px; }
  #centerMsg h1 { margin:.2rem 0 .4rem; font-size:1.6rem; }
  #centerMsg p { margin:.35rem 0; opacity:.9; }
  #centerMsg .small { font-size:.9rem; opacity:.8; }
  /* Touch controls */
  #joystick, #fireBtn { position:fixed; bottom:16px; display:flex; align-items:center; justify-content:center; }
  #joystick { left:16px; width:120px; height:120px; border-radius:50%; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.15); touch-action:none; }
  #stick { width:64px; height:64px; border-radius:50%; background:rgba(255,255,255,.18); border:1px solid rgba(255,255,255,.2); }
  #fireBtn { right:16px; width:84px; height:84px; border-radius:16px; background:rgba(255,80,109,.18); border:2px solid var(--warn); color:#fff; font-weight:800; letter-spacing:.5px; }
  #fireBtn[hidden] { display:none; }
  .blink { animation:blink 1s infinite; }
  @keyframes blink { 50% { opacity:.3 } }
</style>
</head>
<body>
<canvas id="game"></canvas>

<div class="hud">
  <div class="pill">Level: <span id="level">1</span></div>
  <div class="pill">Time: <span id="time">30.0</span>s</div>
  <div class="pill">Lives: <span id="lives">3</span></div>
  <div class="pill">Score: <span id="score">0</span></div>
</div>

<div id="centerMsg">
  <div class="card">
    <h1>🚀 Rocket vs. Asteroids</h1>
    <p>Drag the joystick to move. Avoid everything. Starting on <b>Level 2</b> aliens sweep the screen—<b>don’t touch them</b>.</p>
    <p>From <b>Level 3</b>, tap <b>FIRE</b> to blast asteroids. (Aliens can’t be hit.) Survive 30 seconds per level to advance.</p>
    <p class="small">Desktop: WASD/Arrow keys to move, Space to fire.</p>
    <p><button id="startBtn">Start Game</button></p>
  </div>
</div>

<!-- Touch controls -->
<div id="joystick" aria-label="move"><div id="stick"></div></div>
<button id="fireBtn" aria-label="fire" hidden>FIRE</button>

<script>
(function(){
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const hud = {
    level: document.getElementById('level'),
    time: document.getElementById('time'),
    lives: document.getElementById('lives'),
    score: document.getElementById('score')
  };
  const centerMsg = document.getElementById('centerMsg');
  const startBtn = document.getElementById('startBtn');
  const joystick = document.getElementById('joystick');
  const stick = document.getElementById('stick');
  const fireBtn = document.getElementById('fireBtn');

  let W=0,H=0, DPR=window.devicePixelRatio||1;
  function resize(){
    W = canvas.clientWidth = window.innerWidth;
    H = canvas.clientHeight = window.innerHeight;
    canvas.width = Math.floor(W*DPR);
    canvas.height = Math.floor(H*DPR);
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }
  window.addEventListener('resize', resize, {passive:true});
  resize();

  // Game state
  const STATE = {
    level: 1,
    lives: 3,
    timeLeft: 30,
    score: 0,
    running: false,
    over: false
  };

  // Entities
  const player = {
    x: W/2, y: H*0.8, r: 14, speed: 240, vx:0, vy:0, cooldown:0
  };
  let asteroids = [];
  let aliens = [];
  let lasers = [];

  // Difficulty curve per level
  const levelCfg = [
    null,
    { astRate: 0.9, astSpeed:[90,180], astSize:[12,26], alienRate: 0 },            // L1
    { astRate: 0.85, astSpeed:[110,200], astSize:[12,28], alienRate: 7 },          // L2
    { astRate: 0.8, astSpeed:[130,220], astSize:[12,28], alienRate: 6, laser:true }, // L3
    { astRate: 0.75, astSpeed:[150,240], astSize:[12,30], alienRate: 5, laser:true }, // L4
    { astRate: 0.7, astSpeed:[170,270], astSize:[12,32], alienRate: 4.5, laser:true }, // L5
  ];

  // Helpers
  const rand = (a,b)=> a + Math.random()*(b-a);
  const chance = p => Math.random()<p;
  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
  function circleHit(ax,ay,ar, bx,by,br){
    const dx=ax-bx, dy=ay-by;
    return (dx*dx + dy*dy) <= (ar+br)*(ar+br);
  }

  function resetLevel(lv=1){
    STATE.level = lv;
    STATE.timeLeft = 30;
    asteroids.length = 0; aliens.length = 0; lasers.length = 0;
    player.x = W/2; player.y = H*0.8; player.vx=player.vy=0; player.cooldown=0;
    fireBtn.hidden = !levelCfg[STATE.level].laser;
    hud.level.textContent = STATE.level;
    hud.time.textContent = STATE.timeLeft.toFixed(1);
  }

  function startGame(){
    STATE.lives = 3; STATE.score = 0; STATE.over=false;
    hud.lives.textContent = STATE.lives;
    hud.score.textContent = STATE.score;
    resetLevel(1);
    STATE.running = true;
    centerMsg.style.display='none';
    lastTs = performance.now();
    requestAnimationFrame(loop);
  }

  // Spawners
  let astSpawnAcc=0, alienSpawnAcc=0;
  function spawnAsteroid(){
    const cfg = levelCfg[STATE.level];
    const r = rand(cfg.astSize[0], cfg.astSize[1]);
    const x = rand(r, W-r);
    const y = -r - 10;
    const sp = rand(cfg.astSpeed[0], cfg.astSpeed[1]);
    const drift = rand(-30,30);
    asteroids.push({x,y,r, vx:drift, vy:sp});
  }
  function spawnAlien(){
    const size = rand(18,26);
    const top = rand(60, H*0.65);
    const fromLeft = chance(0.5);
    const speed = rand(80,130) * (fromLeft?1:-1);
    aliens.push({x: fromLeft? -40: W+40, y: top, r:size, vx:speed});
  }
  function shoot(){
    if (!levelCfg[STATE.level].laser) return;
    if (player.cooldown>0) return;
    lasers.push({x: player.x, y: player.y - player.r - 6, r:4, vy:-420});
    player.cooldown = 0.22; // seconds
  }

  // Input: keyboard
  const keys = {};
  window.addEventListener('keydown', e=>{
    if (['ArrowUp','ArrowDown','ArrowLeft','ArrowRight',' ',"Space","w","a","s","d","W","A","S","D"].includes(e.key)) e.preventDefault();
    keys[e.key] = true;
    if ((e.key===' '||e.key==='Space') && STATE.running) shoot();
  }, {passive:false});
  window.addEventListener('keyup', e=>{ keys[e.key] = false; }, {passive:true});

  // Input: joystick
  let joyActive=false, joyCx=0, joyCy=0, joyDx=0, joyDy=0;
  function setStick(dx,dy){
    const max=40, len=Math.hypot(dx,dy);
    const scale = len>max? max/len : 1;
    stick.style.transform = `translate(${dx*scale}px,${dy*scale}px)`;
    joyDx = dx*scale; joyDy = dy*scale;
  }
  joystick.addEventListener('pointerdown', e=>{
    joyActive=true;
    const r = joystick.getBoundingClientRect();
    joyCx = r.left + r.width/2;
    joyCy = r.top + r.height/2;
    setStick(e.clientX-joyCx, e.clientY-joyCy);
    joystick.setPointerCapture(e.pointerId);
  });
  joystick.addEventListener('pointermove', e=>{
    if(!joyActive) return;
    setStick(e.clientX-joyCx, e.clientY-joyCy);
  });
  const joyEnd = e=>{ joyActive=false; setStick(0,0); };
  joystick.addEventListener('pointerup', joyEnd);
  joystick.addEventListener('pointercancel', joyEnd);
  fireBtn.addEventListener('pointerdown', e=>{ e.preventDefault(); shoot(); });

  // Game loop
  let lastTs = 0;
  function loop(ts){
    if (!STATE.running) return;
    const dt = Math.min(0.033, (ts - lastTs)/1000); // cap delta
    lastTs = ts;

    // Update timers
    STATE.timeLeft -= dt;
    if (STATE.timeLeft <= 0){
      // next level or win
      if (STATE.level >= 5){
        winGame();
        return;
      } else {
        levelUp();
      }
    }
    hud.time.textContent = Math.max(0,STATE.timeLeft).toFixed(1);

    // Spawn
    const cfg = levelCfg[STATE.level];
    astSpawnAcc += dt;
    if (astSpawnAcc >= cfg.astRate){
      astSpawnAcc = 0;
      spawnAsteroid();
    }
    if (cfg.alienRate>0){
      alienSpawnAcc += dt;
      if (alienSpawnAcc >= cfg.alienRate){
        alienSpawnAcc = 0;
        spawnAlien();
      }
    }

    // Player movement
    const kx = (+!!(keys['ArrowRight']||keys['d']||keys['D'])) - (+!!(keys['ArrowLeft']||keys['a']||keys['A']));
    const ky = (+!!(keys['ArrowDown']||keys['s']||keys['S'])) - (+!!(keys['ArrowUp']||keys['w']||keys['W']));
    const joyVX = joyDx/40, joyVY = joyDy/40;

    const dirx = clamp(kx + joyVX, -1, 1);
    const diry = clamp(ky + joyVY, -1, 1);
    const speed = player.speed;
    player.x += dirx * speed * dt;
    player.y += diry * speed * dt;
    player.x = clamp(player.x, player.r, W - player.r);
    player.y = clamp(player.y, player.r, H - player.r);
    if (player.cooldown>0) player.cooldown -= dt;

    // Update asteroids
    for (let i=asteroids.length-1;i>=0;i--){
      const a = asteroids[i];
      a.x += a.vx * dt;
      a.y += a.vy * dt;
      // drift wrap
      if (a.x < -40) a.x = W+40;
      if (a.x > W+40) a.x = -40;
      if (a.y - a.r > H+50){ asteroids.splice(i,1); continue; }

      // Collision with player
      if (circleHit(a.x,a.y,a.r, player.x,player.y,player.r)){
        hitPlayer();
        asteroids.splice(i,1);
        continue;
      }
    }

    // Update aliens (invulnerable)
    for (let i=aliens.length-1;i>=0;i--){
      const al = aliens[i];
      al.x += al.vx * dt;
      // Collision with player
      if (circleHit(al.x,al.y,al.r, player.x,player.y,player.r)){
        hitPlayer();
      }
      if (al.vx>0 && al.x - al.r > W+60) aliens.splice(i,1);
      if (al.vx<0 && al.x + al.r < -60) aliens.splice(i,1);
    }

    // Update lasers
    for (let i=lasers.length-1;i>=0;i--){
      const L = lasers[i];
      L.y += L.vy * dt;
      if (L.y < -20){ lasers.splice(i,1); continue; }
      // Hit asteroids only
      for (let j=asteroids.length-1;j>=0;j--){
        const a = asteroids[j];
        if (circleHit(L.x,L.y,L.r, a.x,a.y,a.r)){
          // pop asteroid
          asteroids.splice(j,1);
          lasers.splice(i,1);
          STATE.score += 10;
          hud.score.textContent = STATE.score;
          break;
        }
      }
    }

    // Draw
    ctx.clearRect(0,0,W,H);
    drawStars(ts);
    drawPlayer();
    drawAsteroids();
    drawAliens();
    drawLasers();

    requestAnimationFrame(loop);
  }

  // Effects
  const stars = Array.from({length:120},()=>({x:Math.random(), y:Math.random(), z:rand(.2,1)}));
  function drawStars(t){
    const time = t/1000;
    for (const s of stars){
      const x = s.x*W;
      const y = ( (s.y + time*0.01*s.z) % 1 ) * H;
      const sz = s.z*2;
      ctx.globalAlpha = .35 + .65*s.z;
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(x,y,sz,sz);
    }
    ctx.globalAlpha = 1;
  }

  function drawPlayer(){
    const {x,y,r} = player;
    // body
    ctx.save();
    ctx.translate(x,y);
    // flame
    ctx.fillStyle = '#ffb347';
    ctx.beginPath();
    ctx.moveTo(-5, r+4);
    ctx.lineTo(5, r+4);
    ctx.lineTo(0, r+rand(12,18));
    ctx.closePath();
    ctx.fill();

    // ship
    ctx.fillStyle = '#8be9fd';
    ctx.beginPath();
    ctx.moveTo(0,-r-6); ctx.lineTo(r, r); ctx.lineTo(-r, r); ctx.closePath();
    ctx.fill();
    // window
    ctx.fillStyle = '#e6f7ff';
    ctx.beginPath(); ctx.arc(0,-r/3, r/3, 0, Math.PI*2); ctx.fill();
    ctx.restore();
  }

  function drawAsteroids(){
    for (const a of asteroids){
      ctx.save();
      ctx.translate(a.x,a.y);
      ctx.fillStyle = '#7a8aa1';
      ctx.beginPath();
      ctx.arc(0,0,a.r,0,Math.PI*2);
      ctx.fill();
      // craters
      ctx.fillStyle = 'rgba(0,0,0,.25)';
      for (let i=0;i<3;i++){
        ctx.beginPath();
        ctx.arc(rand(-a.r*.5,a.r*.5), rand(-a.r*.5,a.r*.5), rand(a.r*.15,a.r*.3), 0, Math.PI*2);
        ctx.fill();
      }
      ctx.restore();
    }
  }
  function drawAliens(){
    for (const al of aliens){
      ctx.save();
      ctx.translate(al.x,al.y);
      // saucer
      ctx.fillStyle = '#a0ffb8';
      ctx.beginPath(); ctx.ellipse(0,0, al.r, al.r*0.55, 0, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle = '#d5ffe3';
      ctx.beginPath(); ctx.arc(0,-al.r*0.25, al.r*0.45, 0, Math.PI*2); ctx.fill();
      // glow
      ctx.globalAlpha=.25;
      ctx.beginPath(); ctx.ellipse(0,al.r*.4, al.r*1.1, al.r*.3, 0, 0, Math.PI*2); ctx.fillStyle='#9bffc0'; ctx.fill();
      ctx.globalAlpha=1;
      ctx.restore();
    }
  }
  function drawLasers(){
    ctx.fillStyle = '#ff506d';
    for (const L of lasers){
      ctx.beginPath();
      ctx.arc(L.x, L.y, L.r, 0, Math.PI*2);
      ctx.fill();
      // trail
      ctx.fillRect(L.x-1, L.y-16, 2, 16);
    }
  }

  function hitPlayer(){
    if (STATE.over) return;
    STATE.lives--;
    hud.lives.textContent = STATE.lives;
    screenFlash();
    if (STATE.lives<=0){
      gameOver();
      return;
    }
    // brief i-frames / clear a bit
    asteroids = asteroids.filter(a=> a.y < player.y - 40);
  }

  function levelUp(){
    STATE.score += 100; hud.score.textContent = STATE.score;
    STATE.level++;
    resetLevel(STATE.level);
    toast(`Level ${STATE.level}!` + (levelCfg[STATE.level].laser?' Laser online.':''), 1800);
  }

  function winGame(){
    STATE.running=false; STATE.over=true;
    center(`🏆 You win!<br/>Score: <b>${STATE.score}</b><br/><small>Tap Start to play again.</small>`);
  }
  function gameOver(){
    STATE.running=false; STATE.over=true;
    center(`💥 Game Over<br/>Score: <b>${STATE.score}</b><br/><small>Tap Start to try again.</small>`);
  }

  // UI helpers
  function center(html){
    centerMsg.style.display='flex';
    centerMsg.querySelector('.card').innerHTML = `
      <h1 class="blink">Rocket vs. Asteroids</h1>
      <p>${html}</p>
      <p><button id="restartBtn">Start</button></p>`;
    const rb = document.getElementById('restartBtn');
    rb?.addEventListener('click', startGame);
  }
  function toast(text, ms=1200){
    const d = document.createElement('div');
    d.textContent = text;
    d.style.position='fixed'; d.style.left='50%'; d.style.top='14%';
    d.style.transform='translateX(-50%)';
    d.style.background='rgba(0,0,0,.6)';
    d.style.border='1px solid rgba(255,255,255,.2)';
    d.style.borderRadius='12px';
    d.style.padding='8px 12px';
    d.style.zIndex='99';
    document.body.appendChild(d);
    setTimeout(()=>d.remove(), ms);
  }
  function screenFlash(){
    const f = document.createElement('div');
    f.style.position='fixed'; f.style.inset='0'; f.style.background='#ff506d55'; f.style.backdropFilter='blur(1px)';
    f.style.pointerEvents='none'; f.style.zIndex='5';
    document.body.appendChild(f);
    setTimeout(()=>f.remove(), 120);
  }

  // Buttons
  startBtn.addEventListener('click', startGame);

  // Prevent iOS double-tap zoom on buttons
  let lastTap = 0;
  document.addEventListener('touchend', e=>{
    const now = +new Date();
    if (now - lastTap < 300) e.preventDefault();
    lastTap = now;
  }, {passive:false});

  // Initial draw
  drawStars(0); drawPlayer();
})();
</script>
</body>
</html>
